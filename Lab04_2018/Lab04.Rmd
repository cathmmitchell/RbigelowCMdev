---
title: "Lab 4: Visualizing XXXXXXXXXXXXx"
output: html_notebook
---

This lab focuses on visualizing XXXXXXXXXXXXXXX. The tools you are introduced to here can be used to graph and analyze data in your labs, your independent research projects and the cruise data gathered throughout the semester. Be sure to save any scripts that you develop so you can continue to use them.

# 1. Importing and wrangling data


Let's start by importing the data as before.

```{r}
# read in the whole csv file
CTDdata <- read.csv('Colby_cruise_data_2012-2017.csv')
```

Formatting the dates

```{r}
#making a list of the dates of each cruise
dates <- CTDdata[['Date']]

# making a list of the year
years <- floor(dates/10000)

# making a list of the months and days in mmdd format
monthdays <- dates - (years*10000)

# making a list of the months
mnths <- floor(monthdays/100)

# making a list of the days
days <- monthdays - (mnths*100)

# converting our dates to R date-times
Rdates <- ISOdate(years,mnths,days)

# determining the day of year (Julian Day) for each date
jday <- strftime(Rdates, format = '%j')

# add these to our dataframe
CTDdata$year <- years
CTDdata$month <- mnths
CTDdata$day <- days
CTDdata$doy <- jday
```


Wrangling data for making depth vs day plot for one station & one year

```{r}
index <- (years == 2016)# & (mnths == 9) & (days == 8)

yearData <- CTDdata[index,]

stationData <- yearData[yearData$Station == 4,]

doy <- unique(stationData$doy)
numCols <- length(doy)

#creating an empty matrix with 100 rows (i.e. for 100 depths) and a column for each cruise in this year
TEM <- matrix(NA,nrow = 100, ncol = numCols)

#looping through each cruise
for (i in seq_along(doy)){
  #looping through each depth interval (from 1m to 100m)
  for (j in 1:100){
    #extracting the relevant cruise from the stationData data frame
    cruiseData <- stationData[stationData$doy == doy[i],]
    
    #binned temperature value for given depth interval
    temp = mean(cruiseData[ceiling(cruiseData$Depth)==j,'Temperature']) 

    #assinging the binned temperature to the j-th row and st-th column of the TEM matrix
    TEM[j,i] <- temp
  }
}


```

```{r}
library("fields")

image.plot(x=as.numeric(doy),y=-100:-1,t(TEM[100:1,]),
           zlim=c(8,20),
           col=tim.colors(200),
           xlab='day of year',
           ylab='Depth (m)',
           main='Station 4, 2016',
           legend.lab='Temperature (C)',
legend.line=2.5)
```

Let's make this into a couple of funtions:

```{r}
#function for converting our data into a matrix for a given year and station (yesterday we did this for a given cruise)
col2matrix_yr_st <- function(CTDdata,yr,st,colName){
  index <- (years == yr)
  
  yearData <- CTDdata[index,]
  
  stationData <- yearData[yearData$Station == st,]
  
  doy <- unique(stationData$doy)
  numCols <- length(doy)
  
  #creating an empty matrix with 100 rows (i.e. for 100 depths) and a column for each cruise in this year
  TEM <- matrix(NA,nrow = 100, ncol = numCols)
  
  #looping through each cruise
  for (i in seq_along(doy)){
    #looping through each depth interval (from 1m to 100m)
    for (j in 1:100){
      #extracting the relevant cruise from the stationData data frame
      cruiseData <- stationData[stationData$doy == doy[i],]
      
      #binned temperature value for given depth interval
      temp = mean(cruiseData[ceiling(cruiseData$Depth)==j,colName]) 
  
      #assinging the binned temperature to the j-th row and st-th column of the TEM matrix
      TEM[j,i] <- temp
    }
  }
  returnList = list(mat = TEM,doy = doy)
  return(returnList)
}

#function to plot
sectionPlot <- function(x,z,zLims,title,colName){
  image.plot(x=x,y=-100:-1,t(z[100:1,]),
             zlim=zLims,
             col=tim.colors(200),
             xlab='day of year',
             ylab='Depth (m)',
             main=title,
             legend.lab=colName,
  legend.line=2.5)
}

```

Let's try out these functions for a different year:

```{r}

output <- col2matrix_yr_st(CTDdata,2017,4,'Temperature')
sectionPlot(x=as.numeric(output$doy),z = output$mat, zLims = c(8,20), 
            title = 'Station4, 2017',colName = 'Temperature (deg C)')

```

Or what about a plot for all the stations in 2016:
```{r}

for (i in 1:4){
  output <- col2matrix_yr_st(CTDdata,2016,i,'Temperature')
  sectionPlot(x=as.numeric(output$doy),z = output$mat, zLims = c(8,20), 
              title = paste('Station ',i,', 2016', sep=''),colName = 'Temperature (deg C)')
}
```




# Assignment

For a given variable (& year??), write a couple of paragraphs of a results + discussion section of a paper, describing the patterns observed in the data in terms of space (i.e. how does the variable change upriver vs open ocean, and at the surface compared to depth) and time (i.e. how does the variable change as the season progresses). Include (1) at least one contour plot, and (2) at least one section plot.
